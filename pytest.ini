# Pytest Configuration for Information Retrieval System
# pytest 測試框架配置檔

[pytest]

# ============================================
# Test Discovery - 測試發現設定
# ============================================

# 測試檔案搜尋路徑
testpaths = tests

# 測試檔案命名模式
python_files = test_*.py

# 測試類別命名模式
python_classes = Test*

# 測試函式命名模式
python_functions = test_*

# ============================================
# Test Execution Options - 測試執行選項
# ============================================

# 預設命令列選項
addopts =
    # 詳細輸出模式
    -v
    # 顯示測試執行的詳細追蹤資訊（當測試失敗時）
    --tb=short
    # 嚴格標記模式（未註冊的標記會導致錯誤）
    --strict-markers
    # 顯示測試執行時間較長的前 10 個測試
    --durations=10
    # 覆蓋率報告
    --cov=src/ir
    --cov-report=html
    --cov-report=term-missing
    --cov-report=xml
    # 顯示局部變數（當測試失敗時）
    -l
    # 在第一個錯誤或失敗時停止（可選，開發時使用）
    # -x
    # 顯示所有輸出（包含 print 語句）
    -s

# ============================================
# Markers - 測試標記
# ============================================

# 註冊的標記（用於分類測試）
markers =
    # 單元測試（快速，無外部依賴）
    unit: Unit tests for individual functions and classes

    # 整合測試（較慢，可能涉及檔案 I/O 或多模組）
    integration: Integration tests for multiple components

    # 效能測試（測量執行時間與記憶體使用）
    performance: Performance and benchmark tests

    # 慢速測試（執行時間 > 1 秒）
    slow: Tests that take more than 1 second to run

    # 需要外部資源的測試（網路、資料庫等）
    external: Tests requiring external resources

    # CSoundex 模組測試
    csoundex: Tests for CSoundex module

    # 索引模組測試
    index: Tests for indexing modules

    # 檢索模組測試
    retrieval: Tests for retrieval modules

    # 評估模組測試
    evaluation: Tests for evaluation metrics

    # 需要測試資料的測試
    requires_data: Tests that need test datasets

# ============================================
# Coverage Options - 覆蓋率選項
# ============================================

# 覆蓋率報告排除的檔案模式
[coverage:run]
omit =
    */tests/*
    */venv/*
    */env/*
    */__pycache__/*
    */site-packages/*
    setup.py

# 覆蓋率報告設定
[coverage:report]
# 忽略完全覆蓋的檔案
skip_covered = False

# 顯示缺少覆蓋的行號
show_missing = True

# 精確度（小數點後位數）
precision = 2

# 覆蓋率目標（低於此值會失敗）
fail_under = 80

# 排除的程式碼行（正則表達式）
exclude_lines =
    # 標準的排除模式
    pragma: no cover
    def __repr__
    def __str__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstract
    @abc.abstractmethod

# ============================================
# Test Output - 測試輸出設定
# ============================================

# 控制台輸出模式
console_output_style = progress

# 日誌捕獲級別
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# ============================================
# Timeout Settings - 超時設定
# ============================================

# 單一測試的最大執行時間（秒）
timeout = 300

# 超時處理方法（signal 或 thread）
timeout_method = thread

# ============================================
# Usage Examples - 使用範例
# ============================================
#
# 執行所有測試：
#   pytest
#
# 執行特定模組的測試：
#   pytest tests/test_csoundex.py
#
# 執行帶有特定標記的測試：
#   pytest -m unit
#   pytest -m "unit and csoundex"
#   pytest -m "not slow"
#
# 只執行失敗的測試：
#   pytest --lf
#
# 執行新增或修改的測試：
#   pytest --nf
#
# 產生 HTML 覆蓋率報告：
#   pytest --cov=src/ir --cov-report=html
#   # 然後開啟 htmlcov/index.html
#
# 平行執行測試（需要 pytest-xdist）：
#   pytest -n auto
#
# 詳細輸出模式（顯示每個測試）：
#   pytest -vv
#
# 只執行快速測試（排除慢速測試）：
#   pytest -m "not slow"
